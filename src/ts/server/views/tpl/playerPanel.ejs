<style>
    .inputPanel {
        width: 100%;
        left: 60px;
        top: 200px;
        position: absolute;
        display: none;
        z-index: 99;
    }

    #playerName {
        display: inline-block;
        font-size: 30px;
        font-family: 'Microsoft Yahei';
    }

    #playerNameShadow {
        display: inline-block;
        font-size: 30px;
        font-family: 'Microsoft Yahei';
    }

    .nameBlue {
        display: inline-block;
        font-size: 30px;
        font-family: 'Microsoft Yahei';
        background: -webkit-gradient(linear, 0% 20%, 0% 100%, from(#ddecff), to(#5f7aef));
        color: transparent;
        -webkit-text-fill-color: transparent;
        -webkit-background-clip: text;
        position: absolute;
        z-index: 10;
    }

    .nameShadowBlue {
        display: inline-block;
        font-size: 30px;
        font-family: 'Microsoft Yahei';

        text-shadow: 0 0 0.08em #003f8e,
        -0 -0 0.08em #003f8e;
        position: absolute;
        z-index: 9;
    }

    .nameRed {
        display: inline-block;
        font-size: 30px;
        font-family: 'Microsoft Yahei';
        background: -webkit-gradient(linear, 0% 20%, 0% 100%, from(#ffe5ec), to(#ff88aa));
        color: transparent;
        -webkit-text-fill-color: transparent;
        -webkit-background-clip: text;
        position: absolute;
        z-index: 10;
    }

    .nameShadowRed {
        display: inline-block;
        font-size: 30px;
        font-family: 'Microsoft Yahei';

        text-shadow: 0 0 0.08em #681d19,
        -0 -0 0.08em #003f8e;
        position: absolute;
        z-index: 9;
    }

</style>
<label id="playerNameShadow"></label>
<label id="playerName"></label>
<div class="inputPanel">
    <div class="playerPanel">
        player id:
        <div class="pickupPlayer">
            <img class="playerAvatar" src="/img/player/p0.png">
            <input class="playerId" type="text" style="width: 75px"/>
            <input class="btnQuery" type="button" value="query" data-pos="0"/>
            <input class="btnUpdate" type="button" value="update↓↓↓" data-pos="0"/><br>
            <input class="btnFadeOut" type="button" value="fadeOut" data-pos="0"/><br>
            <label id="moveState"></label>
        </div>
    </div>
</div>
<div class="Preloader" style="display: none">
    <img src="/img/panel/playerPanelBlue.png">
    <img src="/img/panel/playerPanelRed.png">
</div>
<script>
    var onServer = function () {
        cmd.on(CommandId.initPanel, function (param) {
            console.log("initPanel::::::::", param);
            //            console.log(this, "initParam");
            if (param.playerInfo) {
                fadeInPlayerPanel(new PlayerInfo(param.playerInfo));
            }
            moveCtn(param.position.ctnX, param.position.ctnY);
        })
        cmd.on(CommandId.fadeInPlayerPanel, function (param) {
            var playerInfo = new PlayerInfo(param);
            console.log("PlayerInfo:", playerInfo);
            fadeInPlayerPanel(playerInfo);
        })
        cmd.on(CommandId.fadeOutPlayerPanel, function () {
            fadeOutPlayerPanel();
        });
        cmd.on(CommandId.movePlayerPanel, function (param) {
            moveCtn(param.ctnX, param.ctnY);
        });
    }
</script>
<script>
    var toggleMove = function () {
        isMoving = !isMoving;
        $("#moveState").html(isMoving.toString());
    }
    var onKeyPress = function () {
        document.onkeydown = function (e) {
            var key = e.keyCode;
            var isCtrl = e.ctrlKey;
            var isShift = e.shiftKey;
            var isAlt = e.altKey;
            console.log("key:", key);
//            var isMoving = false;
            var ctn = client.panel.ctn;

            var ofs = 1;
            if (isShift)
                ofs = 10;
            var cx = ctn.x;
            var cy = ctn.y;
            if (key == 38)//up
            {
                cy = ctn.y - ofs;
            }
            else if (key == 40)//down
            {
                cy = ctn.y + ofs;
            }
            else if (key == 37)//left
            {
                cx = ctn.x - ofs;
            }
            else if (key == 39)//right
            {
                cx = ctn.x + ofs;
            }
            else if (key == 77)//key m :
            {
                isMoving = !isMoving;
            }
            if (isMoving)
                cmd.proxy(CommandId.cs_movePlayerPanel,
                        {
                            ctnX: cx,
                            ctnY: cy
                        });
        };
    }
    document.onmouseup = function () {
        isMoving = false;
    }
    var lastClientX = -1;
    var lastClientY = -1;
    document.onmousemove = function (e) {

        if (isMoving) {
            var dx;
            var dy;
            if (lastClientX != -1) {
                dx = e.clientX - lastClientX;
            }
            if (lastClientY != -1) {
                dy = e.clientY - lastClientY;
            }

            cmd.proxy(CommandId.cs_movePlayerPanel,
                    {
                        ctnX: client.panel.ctn.x + dx,
                        ctnY: client.panel.ctn.y + dy
                    });
//            console.log(e);
        }
        lastClientX = e.clientX;
        lastClientY = e.clientY;

    }

</script>
<script>
    var playerId;
    var playerName$;
    var playerNameShadow$;
    var isMoving = false;
    $(function () {
        playerName$ = $('#playerName');
        playerNameShadow$ = $('#playerNameShadow');
        $(".btnQuery").click(function (e) {
            playerId = $($(".playerId")[0]).val();
            $.post("/getPlayerInfo/" + playerId, null, function (res) {
                console.log("query player:", res);
                var data = JSON.parse(res);
                $($(".playerAvatar")[0]).attr("src", data.playerInfo.avatar);
            });
        });

        $(".btnUpdate").click(function (e) {
            playerId = $($(".playerId")[0]).val();
            cmd.proxy(CommandId.cs_fadeInPlayerPanel, playerId);
        });

        $(".btnFadeOut").click(function (e) {
            cmd.proxy(CommandId.cs_fadeOutPlayerPanel);
        });

        $("#btnMove").click(function (e) {
            isMoving = !isMoving;
        });


        onKeyPress();
        onServer();
    });

    var movePlayerName = function (x, y) {
        x += 140;
        y += 40;
        $('#playerName').css({left: x, top: y});
        $('#playerNameShadow').css({left: x, top: y});
    }
    var moveCtn = function (x, y) {
        var ctn = client.panel.ctn;
        ctn.x = x;
        ctn.y = y;
        movePlayerName(x, y);
    }


    var fadeInPlayerPanel = function (playerInfo) {
        var ctn = client.panel.ctn;
        ctn.alpha = 1;
        if (ctn.numChildren)
            ctn.removeAllChildren();
        var fxCtn = new createjs.Container()
        ctn.addChild(fxCtn);


        var bgPath = '/img/panel/playerPanel';

        if (playerInfo.isRed)
            bgPath += 'Red.png';
        else
            bgPath += 'Blue.png';

        var bg = new createjs.Bitmap(bgPath);
        fxCtn.addChild(bg);

        var avatarCtn = new createjs.Container();
        avatarCtn.x = 83;
        avatarCtn.y = 82;
        var mask = new createjs.Shape();
        mask.graphics.beginFill("#ff0000").drawCircle(0, 0, 45);
        avatarCtn.addChild(mask);
        fxCtn.addChildAt(avatarCtn,0);

        var img = new Image()
        img.onload = function () {
            var avatar = new createjs.Bitmap(playerInfo.avatar());
            var bound = avatar.getBounds();
            avatar.scaleX = avatar.scaleY = 90 / bound.height;
            avatar.x = -bound.width * .5 * avatar.scaleX;
            avatar.y = -bound.height * .5 * avatar.scaleX;
            avatar.mask = mask;
            avatarCtn.addChild(avatar);

            var bgBound = bg.getBounds();
            fxCtn.cache(0, 0, bgBound.width, bgBound.height);

        }
        img.src = playerInfo.avatar();



        var eloScore = new createjs.Text(playerInfo.eloScore(), '30px Microsoft Yahei', '#f2f2f2')
        eloScore.textAlign = 'left';
        eloScore.x = 190;
        eloScore.y = 85;
        fxCtn.addChild(eloScore);

        if (playerInfo.isRed) {
            playerName$.addClass('nameRed');
            playerNameShadow$.addClass('nameShadowRed');
        }
        else {
            playerName$.addClass('nameBlue');
            playerNameShadow$.addClass('nameShadowBlue');
        }
        movePlayerName(ctn.x, ctn.y);
        playerName$.html(playerInfo.name());
        playerNameShadow$.html(playerInfo.name());

    }

    var fadeOutPlayerPanel = function () {
        var ctn = client.panel.ctn;
        createjs.Tween.get(ctn).to({alpha: 0}, 100);
        playerName$.html('');
        playerNameShadow$.html('');
    }

</script>
